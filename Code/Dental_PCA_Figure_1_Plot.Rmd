---
title: "PCA Dental Measurements GGPLOT"
#output: html_notebook
---
# Figure 1 plot

Making a PCA plot from dental measurements, colored by clade. 

Figure 1 in the text has the tooth and phylopic figures added to it in affinity design. m

#### Load Packages
```{r}
pacman::p_load(tidyverse, patchwork, ggstar, here, paletteer, ggstar)

here::i_am("Code/Dental_PCA_Figure_1_Plot.Rmd")
```

#### Read Data
```{r}
input_data_1<- read.delim(here("Data", "Master_Data.txt")) %>% 
  drop_na('bird') %>% 
  select(1:10) %>% 
  drop_na() %>% 
  mutate(Family = as.factor(Family)) %>% arrange(Family)

#palette taken from the ggsci springfield_simpsons palette. 
pal5 <- paletteer_d("ggsci::springfield_simpsons") 
pal5.2 <- pal5[c(1:3,8,5,15,7,4,9:12)]
```

## PCA  
```{r}
set.seed(2)
pca1<-prcomp(input_data_1[4:10], scale.=TRUE, center=TRUE)

## Test Plot
pdat <- pca1$x %>% as_tibble() %>% bind_cols(input_data_1)
pdat  %>% ggplot(aes(x = PC1, y = PC2)) +
  geom_point(aes(color = Family,
                 fill = Family))
```


## Plot 

```{r}
#convex hulls
hull <- pdat %>% 
  group_by(Family) %>% 
  slice(chull(PC1, PC2))

# Plot
pcplot <- pdat  %>% ggplot(aes(x = PC1, y = PC2)) +
  geom_star(aes(starshape = Family,
                     color = Family,
                     fill = Family),
                 size = 1.5) +
  scale_starshape_manual(c(25, 11, 15, 13, 28, 23, 5, 14, 29, 2, 27, 1)) +
  geom_polygon(aes(fill = Family, 
                   color = Family),
               data = hull, 
               alpha = 0.2, 
               show.legend = F,
               size = 0.2) +
  labs(x = "PC 1 (64%)", y = "PC 2 (18%)") +
  theme_classic() +
  theme(legend.title = element_blank(), 
        legend.position = "bottom",
        panel.background = element_rect(fill = "white", 
                                        colour = NULL),
        axis.text.y = element_text(angle = 90, size=rel(0.75)),
        axis.text.x = element_text(size=rel(0.75)),
        legend.text=element_text(size=rel(0.75)),
        axis.title.y = element_text(size = rel(0.8)),
        axis.title.x = element_text(size = rel(0.8)),
        legend.background = element_rect(fill='transparent'),
        legend.spacing.y = unit(0.001, 'lines'),
        legend.key.size = unit(0.4, 'lines'),
        legend.box.margin = margin(-12,-10,-10,-30)) +
      guides(color =     guide_legend(byrow = TRUE, override.aes = list(size = 1.5),  ncol = 4),
             fill =      guide_legend(byrow = TRUE, override.aes = list(size = 1.5),  ncol = 4),
             starshape = guide_legend(byrow = TRUE, override.aes = list(size = 1.5),  ncol = 4)) + 
  coord_fixed()  +  scale_fill_manual(values = pal5.2) +scale_color_manual(values = pal5.2)
pcplot

ggsave(here("Plots", "Figure_1.pdf"),width = 3.5, height = 3.5)
ggsave(here("Plots", "Figure_1.png"),width = 3.5, height = 3.5)
```
